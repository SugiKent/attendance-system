# ポケット勤怠 設計書

## 1. システム概要

ポケット勤怠は、従業員の勤怠状況を記録・管理するためのウェブアプリケーションです。出退勤の記録、休暇申請の管理、勤怠データに基づいたレポート生成などの機能を提供します。

## 2. 機能要件

### 2.1 認証機能

- ユーザー登録（管理者のみ実行可能）
- ログイン/ログアウト
- パスワードリセット
- ロールベースのアクセス制御（一般従業員/管理者/スーパー管理者）

### 2.2 企業管理機能

- 企業の作成/編集/削除（スーパー管理者のみ）
- 企業固有の設定管理
- 企業間のユーザー管理
- 複数企業の管理（スーパー管理者）

### 2.3 勤怠記録機能

- 出勤打刻
- 退勤打刻
- 勤務時間の自動計算
- 勤怠履歴の表示
- 勤務時間サマリーの表示

### 2.4 休暇管理機能

- 休暇申請の作成
- 休暇申請の承認/却下（管理者）
- 休暇履歴の表示
- 休暇残日数の管理

### 2.5 レポート機能

- 個人の勤怠レポート生成
- 部門別の勤怠レポート生成（管理者）
- レポートのエクスポート（CSV/Excel）

## 3. データモデル

### 3.1 Company（企業）

| フィールド | 型 | 説明 |
|------------|------|-------------|
| id | String | 企業ID（主キー） |
| publicId | String | 公開ID（一意、ハッシュ化） |
| name | String | 企業名 |
| logoUrl | String | 企業ロゴURL（null可） |
| settings | JSON | 企業固有の設定（JSON形式） |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

### 3.2 User（ユーザー）

| フィールド | 型 | 説明 |
|------------|------|-------------|
| id | String | ユーザーID（主キー） |
| email | String | メールアドレス |
| password | String | パスワード（ハッシュ化） |
| name | String | 氏名 |
| role | Enum | ロール（EMPLOYEE/ADMIN/SUPER_ADMIN） |
| companyId | String | 所属企業ID（外部キー、SUPER_ADMINの場合はnull可） |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

### 3.3 AttendanceRecord（勤怠記録）

| フィールド | 型 | 説明 |
|------------|------|-------------|
| id | String | 記録ID（主キー） |
| userId | String | ユーザーID（外部キー） |
| date | DateTime | 日付 |
| clockInTime | DateTime | 出勤時間 |
| clockOutTime | DateTime | 退勤時間（null可） |
| notes | String | 備考（null可） |
| location | String | 勤務場所（null可） |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

### 3.4 LeaveRequest（休暇申請）

| フィールド | 型 | 説明 |
|------------|------|-------------|
| id | String | 申請ID（主キー） |
| userId | String | ユーザーID（外部キー） |
| startDate | DateTime | 開始日 |
| endDate | DateTime | 終了日 |
| leaveType | Enum | 休暇種別（PAID/UNPAID/SICK/OTHER） |
| reason | String | 理由 |
| status | Enum | 状態（PENDING/APPROVED/REJECTED） |
| comment | String | コメント（null可） |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

## 4. API設計

### 4.1 認証API

| エンドポイント | メソッド | 説明 |
|---------------|--------|-------------|
| /api/auth/register | POST | ユーザー登録（管理者のみ） |
| /api/auth/login | POST | ログイン |
| /api/auth/me | GET | 現在のユーザー情報取得 |
| /api/auth/reset-password | POST | パスワードリセット |

### 4.2 企業管理API

| エンドポイント | メソッド | 説明 |
|---------------|--------|-------------|
| /api/companies | GET | 企業一覧取得（スーパー管理者のみ） |
| /api/companies | POST | 企業作成（スーパー管理者のみ） |
| /api/companies/:id | GET | 企業詳細取得 |
| /api/companies/:id | PUT | 企業更新（スーパー管理者のみ） |
| /api/companies/:id | DELETE | 企業削除（スーパー管理者のみ） |
| /api/companies/:id/settings | GET | 企業設定取得 |
| /api/companies/:id/settings | PUT | 企業設定更新 |

### 4.3 勤怠記録API

| エンドポイント | メソッド | 説明 |
|---------------|--------|-------------|
| /api/attendance/clock-in | POST | 出勤打刻 |
| /api/attendance/clock-out | POST | 退勤打刻 |
| /api/attendance/today | GET | 今日の勤怠状態取得 |
| /api/attendance/records | GET | 勤怠記録一覧取得 |
| /api/attendance/summary | GET | 勤務時間サマリー取得 |

### 4.4 休暇管理API

| エンドポイント | メソッド | 説明 |
|---------------|--------|-------------|
| /api/leave | POST | 休暇申請作成 |
| /api/leave | GET | 休暇申請一覧取得 |
| /api/leave/:id | GET | 休暇申請詳細取得 |
| /api/leave/:id | PUT | 休暇申請更新 |
| /api/leave/:id/status | PUT | 休暇申請ステータス更新（管理者） |

### 4.5 レポートAPI

| エンドポイント | メソッド | 説明 |
|---------------|--------|-------------|
| /api/reports/user/:userId | GET | ユーザー別レポート取得 |
| /api/reports/department | GET | 部門別レポート取得（管理者） |
| /api/reports/export | GET | レポートエクスポート |

## 5. UI設計

### 5.1 ページ構成

- ログインページ
- ダッシュボード
- 勤怠記録ページ
- 休暇申請ページ
- レポートページ
- 管理者ページ
  - ユーザー管理
  - 承認管理
  - 企業管理（スーパー管理者のみ）
  - スーパー管理者管理（スーパー管理者のみ）

### 5.2 コンポーネント設計

#### 共通コンポーネント
- ヘッダー（ナビゲーション、ユーザー情報）
- サイドバー（メニュー）
- フッター
- ローディングインジケーター
- エラーメッセージ
- 確認ダイアログ

#### 勤怠関連コンポーネント
- 勤怠状態カード（現在の状態表示）
- 出退勤ボタン
- 勤怠履歴テーブル
- 勤務時間サマリーカード

#### 休暇関連コンポーネント
- 休暇申請フォーム
- 休暇申請一覧テーブル
- 休暇カレンダー
- 休暇承認コンポーネント（管理者用）

#### レポート関連コンポーネント
- レポート期間選択
- レポートテーブル
- レポートグラフ
- エクスポートボタン

#### 企業管理関連コンポーネント
- 企業一覧テーブル
- 企業作成フォーム
- 企業編集フォーム
- 企業詳細表示
- 企業設定管理
- 企業切り替えドロップダウン（スーパー管理者用）

## 6. 非機能要件

### 6.1 パフォーマンス

- ページロード時間: 2秒以内
- APIレスポンス時間: 500ms以内
- 同時ユーザー数: 100人以上

### 6.2 セキュリティ

- HTTPS通信
- パスワードのハッシュ化（bcrypt）
- JWTトークンの有効期限設定
- 入力データのバリデーション
- SQLインジェクション対策
- XSS対策

### 6.3 可用性

- 稼働率: 99.9%以上
- バックアップ: 日次
- 障害復旧時間: 4時間以内

### 6.4 拡張性

- マイクロサービスアーキテクチャへの移行容易性
- 新機能追加の容易性
- 外部システム連携の柔軟性

## 7. 開発・運用計画

### 7.1 開発フェーズ

1. **フェーズ1: データモデル実装**
   - Prismaスキーマの更新
   - マイグレーションの実行
   - シードデータの作成

2. **フェーズ2: バックエンドAPI実装**
   - 認証機能の拡張
   - 勤怠記録APIの実装
   - 休暇管理APIの実装
   - レポートAPIの実装

3. **フェーズ3: フロントエンド実装**
   - 状態管理の実装
   - 基本コンポーネントの実装
   - ページコンポーネントの実装
   - API連携の実装

4. **フェーズ4: テスト・最適化**
   - 単体テスト
   - 統合テスト
   - パフォーマンス最適化
   - セキュリティ強化

### 7.2 運用計画

- CI/CDパイプラインの構築
- 監視・ログ収集の設定
- バックアップ・復旧手順の確立
- セキュリティアップデートの定期適用

## 8. 今後の拡張予定

- モバイルアプリ対応
- シフト管理機能
- 給与計算連携
- 位置情報/顔認証による打刻
- 多言語対応
